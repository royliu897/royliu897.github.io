<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roy R. Liu | Portfolio</title>
    <style>
        body, html { margin: 0; padding: 0; overflow: hidden; background: #050704; font-family: 'Georgia', serif; }
        canvas { display: block; cursor: crosshair; }
        #header {
            position: absolute;
            top: 50px; width: 100%; text-align: center;
            color: #f0f0f0; font-style: italic;
            letter-spacing: 2px; pointer-events: none;
            text-shadow: 0 0 20px rgba(0,0,0,0.9);
            z-index: 100;
        }
    </style>
</head>
<body>

<div id="header">
    <h1>Welcome to my webpage, click on something.</h1>
</div>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// --- CONFIGURATION ---
const DOG_W = 32; const DOG_H = 40;
const HORIZON_RATIO = 0.5; 
const DEAD_ZONE = 60;   // Dog won't move if mouse is this close
const LEASH_RADIUS = 280; // Dog walks until mouse exceeds this
const LEAF_COUNT = 450;

let mouse = { x: window.innerWidth/2, y: window.innerHeight/2 };
let dog = { 
    x: 200, y: window.innerHeight * 0.75, vx: 0, vy: 0, 
    row: 3, col: 0, facing: 'right', sitLock: false 
};
let leaves = [];
let icons = [];

const assets = {
    dog: { src: 'assets/dog.png', img: new Image() },
    fallLeaf: { src: 'assets/fall_leaf.png', img: new Image() },
    springLeaf: { src: 'assets/spring_leaf.png', img: new Image() },
    car: { src: 'assets/car.png', img: new Image(), path: 'racing.html' },
    gamma: { src: 'assets/gamma.png', img: new Image(), path: 'research.html' },
    racket: { src: 'assets/racket.png', img: new Image(), path: 'tennis.html' },
    stock: { src: 'assets/stock.png', img: new Image(), path: 'finance.html' }
};

// --- INITIALIZATION ---
function init() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    });

    window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
    window.addEventListener('mousedown', handleInteraction);

    Object.keys(assets).forEach(key => { assets[key].img.src = assets[key].src; });

    const groundTop = canvas.height * HORIZON_RATIO;
    for(let i=0; i<LEAF_COUNT; i++) {
        leaves.push({
            x: Math.random() * canvas.width, 
            y: groundTop + Math.random() * (canvas.height - groundTop),
            z: 0, vz: 0, vx: 0, vy: 0, 
            rotX: Math.random() * 6, rotY: Math.random() * 6,
            vrX: (Math.random()-0.5)*0.03, vrY: (Math.random()-0.5)*0.03,
            type: Math.random() > 0.5 ? 'fallLeaf' : 'springLeaf',
            frame: Math.floor(Math.random()*5),
            baseSize: 35 + Math.random()*20,
            waftOffset: Math.random() * 100
        });
    }

    const ids = ['car', 'gamma', 'racket', 'stock'];
    icons = ids.map((id, i) => ({
        id, x: (i+1) * (canvas.width/5), y: groundTop + 100 + Math.random()*(canvas.height * 0.3),
        rot: (Math.random()-0.5)*0.5, revealed: false, path: assets[id].path
    }));

    requestAnimationFrame(loop);
}

function handleInteraction() {
    let clickedIcon = icons.find(i => Math.hypot(mouse.x - i.x, mouse.y - i.y) < 120);

    if (clickedIcon && clickedIcon.revealed) {
        window.location.href = clickedIcon.path; // Instant transition
        return;
    }

    // Floomph Physics (Click)
    dog.sitLock = true;
    setTimeout(() => { dog.sitLock = false; }, 1000);

    leaves.forEach(l => {
        let d = Math.hypot(l.x - mouse.x, l.y - mouse.y);
        if (d < 300) {
            let angle = Math.atan2(l.y - mouse.y, l.x - mouse.x);
            let force = (300 - d) * 0.2;
            l.vx = Math.cos(angle) * force;
            l.vy = Math.sin(angle) * force;
            l.vz = 12 + Math.random() * 8; // High vertical pop only on click
            l.vrX = (Math.random()-0.5) * 0.6;
        }
    });

    if (clickedIcon) clickedIcon.revealed = true;
}

function loop() {
    const horizonY = canvas.height * HORIZON_RATIO;

    // --- DRAW BACKGROUND ---
    let skyGrad = ctx.createLinearGradient(0, 0, 0, horizonY);
    skyGrad.addColorStop(0, '#020302'); skyGrad.addColorStop(1, '#0d110a');
    ctx.fillStyle = skyGrad; ctx.fillRect(0, 0, canvas.width, horizonY);

    let groundGrad = ctx.createLinearGradient(0, horizonY, 0, canvas.height);
    groundGrad.addColorStop(0, '#1a1f16'); groundGrad.addColorStop(1, '#2d3628');
    ctx.fillStyle = groundGrad; ctx.fillRect(0, horizonY, canvas.width, canvas.height - horizonY);

    // --- DOG PHYSICS (LEASH RADII) ---
    let dx = mouse.x - dog.x;
    let targetY = Math.max(horizonY + 50, mouse.y);
    let dy = targetY - dog.y;
    let dist = Math.hypot(dx, dy);
    
    if (!dog.sitLock) {
        if (dist < DEAD_ZONE) {
            // Idle
            dog.vx *= 0.8; dog.vy *= 0.8;
        } else {
            // Move: Walk speed if inside leash, Run speed if outside
            let moveSpeed = dist > LEASH_RADIUS ? 0.06 : 0.03;
            dog.vx = dx * moveSpeed; dog.vy = dy * moveSpeed;
            dog.facing = dog.vx > 0 ? 'right' : 'left';
        }
    } else {
        dog.vx *= 0.8; dog.vy *= 0.8;
    }
    dog.x += dog.vx; dog.y += dog.vy;

    // --- SPRITE SELECTION ---
    let isMoving = Math.abs(dog.vx) > 0.3 || Math.abs(dog.vy) > 0.3;
    if (dog.sitLock || !isMoving) {
        dog.row = 3; dog.col = dog.facing === 'right' ? 0 : 2; 
    } else {
        dog.row = 1; dog.col = (dog.facing === 'right' ? 0 : 2) + (Math.floor(Date.now()/120)%2);
    }

    // --- Y-SORTED RENDERING ---
    let scene = [
        ...icons.map(i => ({ type: 'icon', y: i.y, d: i })),
        ...leaves.map(l => ({ type: 'leaf', y: l.y, d: l })),
        { type: 'dog', y: dog.y, d: dog }
    ].sort((a,b) => a.y - b.y);

    let dogSpeed = Math.hypot(dog.vx, dog.vy);
    let disturbMult = dogSpeed > 4 ? 0.5 : 0.2; // Scaling force

    scene.forEach(ent => {
        let pScale = 0.5 + (ent.y / canvas.height) * 1.1;

        if (ent.type === 'leaf') {
            let l = ent.d;
            let dDog = Math.hypot(l.x - dog.x, l.y - dog.y);
            
            // Walking disturbance: Realistic side-push, almost no vertical pop
            if (dDog < 60 * pScale && !dog.sitLock && isMoving) {
                l.vx += dog.vx * disturbMult;
                l.vy += dog.vy * disturbMult;
                l.vz += disturbMult * 0.2; // Very minimal pop for walking
            }

            // Physics Update
            l.x += l.vx; l.y += l.vy; l.z += l.vz;
            l.rotX += l.vrX; l.rotY += l.vrY;
            
            if (l.z > 0) { 
                l.vz -= 0.3; // Gravity
                l.vx *= 0.95; l.vy *= 0.95; 
                l.vx += Math.sin(Date.now() * 0.004 + l.waftOffset) * 0.45; // Wafting
            } else { 
                l.z = 0; l.vz = 0; l.vx *= 0.75; l.vy *= 0.75; l.vrX *= 0.8;
            }

            if (assets[l.type].img.complete) {
                ctx.save();
                ctx.translate(l.x, l.y - l.z);
                ctx.scale(pScale * Math.sin(l.rotX), pScale * Math.cos(l.rotY));
                ctx.rotate(l.rotX);
                ctx.globalAlpha = 0.4 + (ent.y / canvas.height) * 0.6;
                ctx.drawImage(assets[l.type].img, l.frame*16, 0, 16, 16, -l.baseSize/2, -l.baseSize/2, l.baseSize, l.baseSize);
                ctx.restore();
            }
        } else if (ent.type === 'icon') {
            let i = ent.d;
            if (assets[i.id].img.complete) {
                ctx.save(); ctx.translate(i.x, i.y); ctx.rotate(i.rot); ctx.scale(pScale, pScale);
                ctx.drawImage(assets[i.id].img, -60, -60, 120, 120);
                ctx.restore();
                if (i.revealed) {
                    ctx.fillStyle = "rgba(255,255,255,0.9)"; ctx.font = "italic 16px Georgia"; ctx.textAlign = "center";
                    ctx.fillText(i.id.toUpperCase(), i.x, i.y + (85 * pScale));
                }
            }
        } else {
            if (assets.dog.img.complete) {
                let dSize = 135 * pScale;
                ctx.fillStyle = 'rgba(0,0,0,0.25)';
                ctx.beginPath(); ctx.ellipse(dog.x, dog.y + (30*pScale), 40*pScale, 10*pScale, 0, 0, Math.PI*2); ctx.fill();
                ctx.drawImage(assets.dog.img, dog.col*DOG_W, dog.row*DOG_H, DOG_W, DOG_H, dog.x - dSize/2, dog.y - dSize*0.6, dSize, dSize*1.2);
            }
        }
    });

    requestAnimationFrame(loop);
}

init();
</script>
</body>
</html>
