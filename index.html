<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roy R. Liu</title>
    <style>
        body, html { margin: 0; padding: 0; overflow: hidden; background: #1a1f16; }
        canvas { display: block; cursor: crosshair; }
        #header {
            position: absolute;
            top: 40px; width: 100%; text-align: center;
            color: white; font-family: 'Courier New', Courier, monospace;
            pointer-events: none; text-shadow: 0 0 15px rgba(0,0,0,0.8);
            z-index: 100;
        }
        .page-transition {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #1a1f16; transform: translateY(100%);
            transition: transform 0.6s cubic-bezier(0.7, 0, 0.3, 1);
            z-index: 999;
        }
        .page-transition.active { transform: translateY(0); }
    </style>
</head>
<body>

<div id="header">
    <h1>Welcome to my webpage, click on something.</h1>
</div>
<div id="transition-layer" class="page-transition"></div>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Sprite Specs
const DOG_W = 32; const DOG_H = 40;
const LEASH_RADIUS = 180;

let mouse = { x: window.innerWidth/2, y: window.innerHeight/2 };
let dog = { 
    x: 100, y: 100, vx: 0, vy: 0, 
    row: 3, col: 0, facing: 'right', 
    sitLock: false 
};
let leaves = [];
let icons = [];

const assets = {
    dog: { src: 'assets/dog.png', img: new Image(), loaded: false },
    fallLeaf: { src: 'assets/fall_leaf.png', img: new Image(), loaded: false },
    springLeaf: { src: 'assets/spring_leaf.png', img: new Image(), loaded: false },
    car: { src: 'assets/car.png', img: new Image(), path: 'racing.html' },
    gamma: { src: 'assets/gamma.png', img: new Image(), path: 'research.html' },
    racket: { src: 'assets/racket.png', img: new Image(), path: 'tennis.html' },
    stock: { src: 'assets/stock.png', img: new Image(), path: 'finance.html' }
};

function init() {
    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    });
    window.dispatchEvent(new Event('resize'));
    window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
    window.addEventListener('mousedown', floomph);

    Object.keys(assets).forEach(key => {
        assets[key].img.onload = () => { assets[key].loaded = true; };
        assets[key].img.src = assets[key].src;
    });

    // Populate Leaves: Clumped for "Pile" effect
    for(let i=0; i<450; i++) {
        leaves.push({
            x: Math.random()*canvas.width, 
            y: Math.random()*canvas.height,
            z: 0, vz: 0, // 2.5D Height
            vx: 0, vy: 0, 
            rot: Math.random()*Math.PI*2, vr: 0,
            type: Math.random() > 0.5 ? 'fallLeaf' : 'springLeaf',
            frame: Math.floor(Math.random()*5),
            size: 50 + Math.random()*30
        });
    }

    const ids = ['car', 'gamma', 'racket', 'stock'];
    icons = ids.map((id, i) => ({
        id, x: (i+1) * (canvas.width/5), y: 300 + Math.random()*(canvas.height-450),
        rot: (Math.random()-0.5)*1.2, revealed: false, path: assets[id].path
    }));

    requestAnimationFrame(loop);
}

function floomph() {
    let clickedIcon = icons.find(i => Math.hypot(mouse.x - i.x, mouse.y - i.y) < 120);

    if (clickedIcon && clickedIcon.revealed) {
        document.getElementById('transition-layer').classList.add('active');
        setTimeout(() => { window.location.href = clickedIcon.path; }, 600);
        return;
    }

    // Trigger Dog Sit
    dog.sitLock = true;
    setTimeout(() => { dog.sitLock = false; }, 1200);

    // Radial Leaf Displacement (The "Floomph")
    leaves.forEach(l => {
        let d = Math.hypot(l.x - mouse.x, l.y - mouse.y);
        if (d < 280) {
            let angle = Math.atan2(l.y - mouse.y, l.x - mouse.x);
            let force = (280 - d) * 0.12;
            l.vx = Math.cos(angle) * force;
            l.vy = Math.sin(angle) * force;
            l.vz = 5 + Math.random() * 8; // Throw into air
            l.vr = (Math.random()-0.5) * 0.4;
        }
    });

    if (clickedIcon) clickedIcon.revealed = true;
}

function loop() {
    ctx.fillStyle = '#1e241a';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Dog movement
    let dx = mouse.x - dog.x;
    let dy = mouse.y - dog.y;
    let dist = Math.hypot(dx, dy);
    
    if (!dog.sitLock && dist > LEASH_RADIUS) {
        dog.vx = dx * 0.04;
        dog.vy = dy * 0.04;
        dog.facing = dog.vx > 0 ? 'right' : 'left';
    } else {
        dog.vx *= 0.85; dog.vy *= 0.85;
    }
    dog.x += dog.vx; dog.y += dog.vy;

    // Sprite Logic: Rows 2 (Running) and 4 (Sitting)
    if (dog.sitLock || (Math.abs(dog.vx) < 0.2 && Math.abs(dog.vy) < 0.2)) {
        dog.row = 3; // Row 4 index
        dog.col = dog.facing === 'right' ? 0 : 2; // Standing/Sitting cols
    } else {
        dog.row = 1; // Row 2 index
        dog.col = (dog.facing === 'right' ? 0 : 2) + (Math.floor(Date.now()/100)%2);
    }

    // Combined Y-Sort for Side-View Depth
    let scene = [
        ...icons.map(i => ({ type: 'icon', y: i.y, d: i })),
        ...leaves.map(l => ({ type: 'leaf', y: l.y, d: l })),
        { type: 'dog', y: dog.y, d: dog }
    ].sort((a,b) => a.y - b.y);

    scene.forEach(ent => {
        if (ent.type === 'leaf') {
            let l = ent.d;
            // Physical Interaction
            let dDog = Math.hypot(l.x - dog.x, l.y - dog.y);
            if (dDog < 60) {
                l.vx += dog.vx * 0.4; l.vy += dog.vy * 0.4;
                l.vz += Math.hypot(dog.vx, dog.vy) * 0.2;
            }

            // Gravity & Air Resistance
            l.x += l.vx; l.y += l.vy; l.z += l.vz;
            l.rot += l.vr;
            
            if (l.z > 0) { 
                l.vz -= 0.4; // Gravity
                l.vr *= 0.98;
            } else { 
                l.z = 0; l.vz = 0; 
                l.vx *= 0.85; l.vy *= 0.85; l.vr *= 0.8; // Friction
            }

            if (assets[l.type].loaded) {
                ctx.save();
                // Draw leaf slightly higher based on Z-axis for 2.5D
                ctx.translate(l.x, l.y - l.z); 
                ctx.rotate(l.rot);
                // Shadow
                if (l.z > 2) {
                    ctx.fillStyle = 'rgba(0,0,0,0.15)';
                    ctx.beginPath(); ctx.ellipse(0, l.z, l.size/2, l.size/4, 0, 0, Math.PI*2); ctx.fill();
                }
                ctx.drawImage(assets[l.type].img, l.frame*16, 0, 16, 16, -l.size/2, -l.size/2, l.size, l.size);
                ctx.restore();
            }
        } else if (ent.type === 'icon') {
            let i = ent.d;
            if (assets[i.id].loaded) {
                ctx.save(); ctx.translate(i.x, i.y); ctx.rotate(i.rot);
                ctx.drawImage(assets[i.id].img, -60, -60, 120, 120);
                ctx.restore();
                if (i.revealed) {
                    ctx.fillStyle = "white"; ctx.font = "bold 14px monospace"; ctx.textAlign = "center";
                    ctx.fillText(`[ OPEN ${i.id.toUpperCase()} ]`, i.x, i.y + 85);
                }
            }
        } else {
            if (assets.dog.loaded) {
                // Ground Shadow
                ctx.fillStyle = 'rgba(0,0,0,0.2)';
                ctx.beginPath(); ctx.ellipse(dog.x, dog.y + 30, 40, 12, 0, 0, Math.PI*2); ctx.fill();
                ctx.drawImage(assets.dog.img, dog.col*DOG_W, dog.row*DOG_H, DOG_W, DOG_H, dog.x-70, dog.y-90, 140, 175);
            }
        }
    });

    requestAnimationFrame(loop);
}
init();
</script>
</body>
</html>
