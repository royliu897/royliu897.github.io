<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roy R. Liu | Portfolio</title>
    <style>
        body, html { margin: 0; padding: 0; overflow: hidden; background: #2d3628; }
        canvas { display: block; cursor: crosshair; }
        #header {
            position: absolute;
            top: 40px;
            width: 100%;
            text-align: center;
            color: white;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            pointer-events: none;
            text-shadow: 2px 2px 12px rgba(0,0,0,0.8);
            z-index: 100;
        }
    </style>
</head>
<body>

<div id="header">
    <h1>Welcome to my webpage, click on something.</h1>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const DOG_W = 32; 
const DOG_H = 40;
const LEASH_RADIUS = 200; 

let mouse = { x: window.innerWidth/2, y: window.innerHeight/2 };
let dog = { 
    x: 100, y: 100, vx: 0, vy: 0, 
    state: 'idle', row: 0, col: 0, 
    rowTimer: 0, forceSit: false 
};
let leaves = [];
let particles = [];
let windAngle = 0;

const assets = {
    dog: { src: 'assets/dog.png', img: new Image(), loaded: false },
    fallLeaf: { src: 'assets/fall_leaf.png', img: new Image(), loaded: false },
    springLeaf: { src: 'assets/spring_leaf.png', img: new Image(), loaded: false },
    car: { src: 'assets/car.png', img: new Image(), loaded: false },
    gamma: { src: 'assets/gamma.png', img: new Image(), loaded: false },
    racket: { src: 'assets/racket.png', img: new Image(), loaded: false },
    stock: { src: 'assets/stock.png', img: new Image(), loaded: false }
};

const projectIcons = [
    { id: 'car', x: 250, y: 400, revealed: false, label: 'Longhorn Racing' },
    { id: 'gamma', x: 750, y: 300, revealed: false, label: 'Research Project' },
    { id: 'racket', x: 450, y: 750, revealed: false, label: 'Tennis' },
    { id: 'stock', x: 950, y: 550, revealed: false, label: 'Finance Modeling' }
];

function init() {
    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    });
    window.dispatchEvent(new Event('resize'));

    window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
    window.addEventListener('mousedown', () => {
        dog.forceSit = true;
        projectIcons.forEach(icon => {
            let d = Math.hypot(mouse.x - icon.x, mouse.y - icon.y);
            if (d < 120) {
                icon.revealed = true;
                burstLeaves(icon.x, icon.y, 50);
            }
        });
        // Release sit after 1 second
        setTimeout(() => { dog.forceSit = false; }, 1200);
    });

    Object.keys(assets).forEach(key => {
        assets[key].img.onload = () => { assets[key].loaded = true; };
        assets[key].img.src = assets[key].src;
    });

    // MASSIVE LEAF PILE (800 leaves)
    for(let i=0; i<800; i++) {
        leaves.push({
            x: Math.random()*window.innerWidth, 
            y: Math.random()*window.innerHeight,
            rot: Math.random()*Math.PI*2,
            vRot: 0,
            type: Math.random() > 0.5 ? 'fallLeaf' : 'springLeaf',
            frame: Math.floor(Math.random()*5),
            size: 20 + Math.random()*25,
            driftX: (Math.random()-0.5) * 0.5,
            driftY: (Math.random()-0.5) * 0.5
        });
    }
    requestAnimationFrame(gameLoop);
}

function burstLeaves(x, y, count) {
    for(let i=0; i<count; i++) {
        particles.push({
            x: x, y: y,
            vx: (Math.random()-0.5)*25,
            vy: (Math.random()-0.5)*25 - 8,
            life: 1.0,
            rot: Math.random()*Math.PI,
            vRot: (Math.random()-0.5)*0.4,
            color: Math.random() > 0.5 ? '#d35400' : '#27ae60'
        });
    }
}

function gameLoop() {
    // 1. Background
    ctx.fillStyle = '#2d3628'; 
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Wind calculation
    windAngle += 0.02;
    let currentWind = Math.sin(windAngle) * 0.5;

    // 2. Physics - Rubber Band & States
    let dx = mouse.x - dog.x;
    let dy = mouse.y - dog.y;
    let dist = Math.hypot(dx, dy);
    let oldX = dog.x;
    let oldY = dog.y;

    if (!dog.forceSit) {
        if (dist > LEASH_RADIUS) {
            let speed = dist > LEASH_RADIUS * 1.6 ? 0.07 : 0.03;
            dog.x += dx * speed;
            dog.y += dy * speed;
        }
    } else {
        // Move slightly to click point even while sitting
        dog.x += dx * 0.1;
        dog.y += dy * 0.1;
    }

    let vx = dog.x - oldX;
    let vy = dog.y - oldY;
    let speed = Math.hypot(vx, vy);

    // 3. Animation Control
    if (dog.forceSit) {
        dog.row = 2; // Sitting index
        dog.col = Math.floor(Date.now() / 300) % 2;
    } else if (speed < 0.2) {
        dog.row = 0; // Standing facing me
        dog.col = Math.floor(Date.now() / 500) % 2;
    } else {
        dog.rowTimer--;
        if (dog.rowTimer <= 0) {
            if (Math.abs(vx) > Math.abs(vy)) { dog.row = vx > 0 ? 6 : 7; } 
            else { dog.row = vy > 0 ? 4 : 5; }
            dog.rowTimer = 15; 
        }
        dog.col = Math.floor(Date.now() / (speed > 4 ? 70 : 120)) % 4;
    }

    // 4. 2.5D Rendering (Y-Sort)
    let renderList = [
        ...projectIcons.map(i => ({ type: 'icon', obj: i, y: i.y + 20 })),
        ...leaves.map(l => ({ type: 'leaf', obj: l, y: l.y })),
        { type: 'dog', obj: dog, y: dog.y }
    ];
    renderList.sort((a, b) => a.y - b.y);

    renderList.forEach(item => {
        if (item.type === 'leaf') {
            let l = item.obj;
            // Interaction
            let lDist = Math.hypot(l.x - dog.x, l.y - dog.y);
            if (lDist < 60) {
                l.x += vx * 1.4;
                l.y += vy * 1.4;
                l.vRot += 0.05;
            }
            // Wind & Drift
            l.x += l.driftX + currentWind;
            l.y += l.driftY;
            l.rot += l.vRot;
            l.vRot *= 0.95; // Friction for rotation

            if (assets[l.type].loaded) {
                ctx.save();
                ctx.translate(l.x, l.y);
                ctx.rotate(l.rot);
                ctx.drawImage(assets[l.type].img, l.frame * 16, 0, 16, 16, -l.size/2, -l.size/2, l.size, l.size);
                ctx.restore();
            }
        } else if (item.type === 'icon') {
            let icon = item.obj;
            if (assets[icon.id].loaded) {
                ctx.globalAlpha = icon.revealed ? 1.0 : 0.1;
                ctx.drawImage(assets[icon.id].img, icon.x - 60, icon.y - 60, 120, 120);
                if (icon.revealed) {
                    ctx.globalAlpha = 1.0;
                    ctx.fillStyle = "white";
                    ctx.font = "bold 18px Arial";
                    ctx.textAlign = "center";
                    ctx.fillText(icon.label, icon.x, icon.y + 80);
                }
            }
            ctx.globalAlpha = 1.0;
        } else if (item.type === 'dog') {
            if (assets.dog.loaded) {
                // Ground Shadow
                ctx.fillStyle = 'rgba(0,0,0,0.25)';
                ctx.beginPath();
                ctx.ellipse(dog.x, dog.y + 30, 35, 12, 0, 0, Math.PI*2);
                ctx.fill();
                ctx.drawImage(assets.dog.img, dog.col * DOG_W, dog.row * DOG_H, DOG_W, DOG_H, dog.x-50, dog.y-65, 100, 125);
            }
        }
    });

    // 5. Particle System
    particles.forEach((p, i) => {
        p.x += p.vx; p.y += p.vy; p.vy += 0.4; p.life -= 0.015; p.rot += p.vRot;
        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);
        ctx.fillStyle = p.color;
        ctx.globalAlpha = p.life;
        ctx.fillRect(-10, -10, 20, 20);
        ctx.restore();
        if (p.life <= 0) particles.splice(i, 1);
    });
    ctx.globalAlpha = 1.0;

    requestAnimationFrame(gameLoop);
}
init();
</script>
</body>
</html>
