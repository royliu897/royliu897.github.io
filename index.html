<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roy R. Liu</title>
    <style>
        body, html { margin: 0; padding: 0; overflow: hidden; background: #050704; }
        canvas { display: block; cursor: crosshair; background: #1a1f16; }
        #header {
            position: absolute;
            top: 50px; width: 100%; text-align: center;
            color: #f0f0f0; font-family: 'Georgia', serif; font-style: italic;
            letter-spacing: 2px; pointer-events: none;
            text-shadow: 0 0 20px rgba(0,0,0,0.9);
            z-index: 100;
        }
        /* Fixed Mask Logic */
        #ripple-mask {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 999;
            background: rgba(0,0,0,0); /* Start transparent */
        }
    </style>
</head>
<body>

<div id="header">
    <h1>Welcome to my webpage, click on something.</h1>
</div>
<div id="ripple-mask"></div>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const DOG_W = 32; const DOG_H = 40;
const HORIZON_RATIO = 0.5; 
const LEASH_RADIUS = 240; 

let mouse = { x: window.innerWidth/2, y: window.innerHeight/2 };
let dog = { 
    x: 200, y: window.innerHeight * 0.8, vx: 0, vy: 0, 
    row: 3, col: 0, facing: 'right', sitLock: false 
};
let leaves = [];
let icons = [];

const assets = {
    dog: { src: 'assets/dog.png', img: new Image() },
    fallLeaf: { src: 'assets/fall_leaf.png', img: new Image() },
    springLeaf: { src: 'assets/spring_leaf.png', img: new Image() },
    car: { src: 'assets/car.png', img: new Image(), path: 'racing.html' },
    gamma: { src: 'assets/gamma.png', img: new Image(), path: 'research.html' },
    racket: { src: 'assets/racket.png', img: new Image(), path: 'tennis.html' },
    stock: { src: 'assets/stock.png', img: new Image(), path: 'finance.html' }
};

function init() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    });

    window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
    window.addEventListener('mousedown', handleInteraction);

    // Initialize Assets
    Object.keys(assets).forEach(key => {
        assets[key].img.src = assets[key].src;
    });

    const horizonY = canvas.height * HORIZON_RATIO;

    // Create Leaves
    for(let i=0; i<450; i++) {
        leaves.push({
            x: Math.random() * canvas.width, 
            y: horizonY + Math.random() * (canvas.height - horizonY),
            z: 0, vz: 0, vx: 0, vy: 0, 
            rotX: Math.random() * 6, rotY: Math.random() * 6,
            vrX: (Math.random()-0.5)*0.02, vrY: (Math.random()-0.5)*0.02,
            type: Math.random() > 0.5 ? 'fallLeaf' : 'springLeaf',
            frame: Math.floor(Math.random()*5),
            baseSize: 40 + Math.random()*20,
            sway: Math.random() * 10
        });
    }

    const ids = ['car', 'gamma', 'racket', 'stock'];
    icons = ids.map((id, i) => ({
        id, x: (i+1) * (canvas.width/5), y: horizonY + 100 + Math.random()*(canvas.height - horizonY - 200),
        rot: (Math.random()-0.5)*0.5, revealed: false, path: assets[id].path
    }));

    requestAnimationFrame(loop);
}

function handleInteraction() {
    let clickedIcon = icons.find(i => Math.hypot(mouse.x - i.x, mouse.y - i.y) < 130);

    if (clickedIcon && clickedIcon.revealed) {
        startTransition(clickedIcon.x, clickedIcon.y, clickedIcon.path);
        return;
    }

    // Floomph
    dog.sitLock = true;
    setTimeout(() => { dog.sitLock = false; }, 1200);

    leaves.forEach(l => {
        let d = Math.hypot(l.x - mouse.x, l.y - mouse.y);
        if (d < 300) {
            let angle = Math.atan2(l.y - mouse.y, l.x - mouse.x);
            let force = (300 - d) * 0.18;
            l.vx = Math.cos(angle) * force;
            l.vy = Math.sin(angle) * force;
            l.vz = 10 + Math.random() * 10;
            l.vrX = (Math.random()-0.5)*0.4; l.vrY = (Math.random()-0.5)*0.4;
        }
    });

    if (clickedIcon) clickedIcon.revealed = true;
}

function startTransition(x, y, path) {
    const mask = document.getElementById('ripple-mask');
    let radius = 0;
    function grow() {
        radius += 40;
        mask.style.background = `radial-gradient(circle ${radius}px at ${x}px ${y}px, transparent 95%, #050704 100%)`;
        if (radius < canvas.width * 1.5) {
            requestAnimationFrame(grow);
        } else {
            window.location.href = path;
        }
    }
    grow();
}

function loop() {
    const horizonY = canvas.height * HORIZON_RATIO;
    
    // Draw Background
    let skyGrad = ctx.createLinearGradient(0, 0, 0, horizonY);
    skyGrad.addColorStop(0, '#020302'); skyGrad.addColorStop(1, '#0d110a');
    ctx.fillStyle = skyGrad; ctx.fillRect(0, 0, canvas.width, horizonY);

    let groundGrad = ctx.createLinearGradient(0, horizonY, 0, canvas.height);
    groundGrad.addColorStop(0, '#1a1f16'); groundGrad.addColorStop(1, '#2d3628');
    ctx.fillStyle = groundGrad; ctx.fillRect(0, horizonY, canvas.width, canvas.height - horizonY);

    // Dog movement
    let targetY = mouse.y < horizonY + 50 ? horizonY + 50 : mouse.y;
    let dx = mouse.x - dog.x;
    let dy = targetY - dog.y;
    let dist = Math.hypot(dx, dy);
    
    if (!dog.sitLock && dist > 60) {
        let speedMult = dist > LEASH_RADIUS ? 0.05 : 0.025;
        dog.vx = dx * speedMult; dog.vy = dy * speedMult;
        dog.facing = dog.vx > 0 ? 'right' : 'left';
    } else {
        dog.vx *= 0.85; dog.vy *= 0.85;
    }
    dog.x += dog.vx; dog.y += dog.vy;

    // Sprite state
    if (dog.sitLock || (Math.abs(dog.vx) < 0.2 && Math.abs(dog.vy) < 0.2)) {
        dog.row = 3; dog.col = dog.facing === 'right' ? 0 : 2; 
    } else {
        dog.row = 1; dog.col = (dog.facing === 'right' ? 0 : 2) + (Math.floor(Date.now()/120)%2);
    }

    // Render Depth Sorting
    let scene = [
        ...icons.map(i => ({ type: 'icon', y: i.y, d: i })),
        ...leaves.map(l => ({ type: 'leaf', y: l.y, d: l })),
        { type: 'dog', y: dog.y, d: dog }
    ].sort((a,b) => a.y - b.y);

    let speed = Math.hypot(dog.vx, dog.vy);
    let disturbanceForce = speed > 3 ? 0.6 : 0.25;

    scene.forEach(ent => {
        let pScale = 0.5 + (ent.y / canvas.height) * 1.1;

        if (ent.type === 'leaf') {
            let l = ent.d;
            if (Math.hypot(l.x - dog.x, l.y - dog.y) < 60 * pScale && !dog.sitLock) {
                l.vx += dog.vx * disturbanceForce; l.vy += dog.vy * disturbanceForce;
                l.vz += disturbanceForce * 1.5;
            }
            l.x += l.vx; l.y += l.vy; l.z += l.vz;
            l.rotX += l.vrX; l.rotY += l.vrY;
            if (l.z > 0) { 
                l.vz -= 0.3; l.vx *= 0.97; l.vy *= 0.97;
                l.sway += 0.05; l.vx += Math.sin(l.sway) * 0.4;
            } else { 
                l.z = 0; l.vz = 0; l.vx *= 0.8; l.vy *= 0.8;
            }

            ctx.save();
            ctx.translate(l.x, l.y - l.z);
            ctx.scale(pScale * Math.sin(l.rotX), pScale * Math.cos(l.rotY));
            ctx.rotate(l.rotX);
            if (assets[l.type].img.complete && assets[l.type].img.naturalWidth !== 0) {
                ctx.drawImage(assets[l.type].img, l.frame*16, 0, 16, 16, -l.baseSize/2, -l.baseSize/2, l.baseSize, l.baseSize);
            }
            ctx.restore();
        } else if (ent.type === 'icon') {
            let i = ent.d;
            ctx.save(); ctx.translate(i.x, i.y); ctx.rotate(i.rot); ctx.scale(pScale, pScale);
            if (assets[i.id].img.complete && assets[i.id].img.naturalWidth !== 0) {
                ctx.drawImage(assets[i.id].img, -60, -60, 120, 120);
            }
            ctx.restore();
            if (i.revealed) {
                ctx.fillStyle = "rgba(255,255,255,0.8)"; ctx.font = "italic 16px Georgia"; ctx.textAlign = "center";
                ctx.fillText(i.id.toUpperCase(), i.x, i.y + (85 * pScale));
            }
        } else {
            let dSize = 130 * pScale;
            ctx.fillStyle = 'rgba(0,0,0,0.3)';
            ctx.beginPath(); ctx.ellipse(dog.x, dog.y + (30*pScale), 40*pScale, 10*pScale, 0, 0, Math.PI*2); ctx.fill();
            if (assets.dog.img.complete && assets.dog.img.naturalWidth !== 0) {
                ctx.drawImage(assets.dog.img, dog.col*DOG_W, dog.row*DOG_H, DOG_W, DOG_H, dog.x - dSize/2, dog.y - dSize*0.6, dSize, dSize*1.2);
            }
        }
    });

    requestAnimationFrame(loop);
}
init();
</script>
</body>
</html>
