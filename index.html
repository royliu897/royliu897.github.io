<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roy R. Liu | Portfolio</title>
    <style>
        body, html { margin: 0; padding: 0; overflow: hidden; background: #3d4a35; }
        canvas { display: block; }
        #header {
            position: absolute;
            top: 50px;
            width: 100%;
            text-align: center;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            pointer-events: none;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.6);
            z-index: 10;
        }
    </style>
</head>
<body>

<div id="header">
    <h1>Welcome to my webpage, click on something.</h1>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// --- CONSTANTS FROM YOUR SPRITE SPECS ---
const DOG_W = 32; // 128px / 4 columns
const DOG_H = 40; // 320px / 8 rows
const LEASH_RADIUS = 120; // The "Comfort Zone"

let mouse = { x: window.innerWidth/2, y: window.innerHeight/2 };
let dog = { x: 100, y: 100, vx: 0, vy: 0, state: 'idle', row: 2, col: 0 };
let leaves = [];
let particles = [];

const assets = {
    dog: { src: 'assets/dog.png', img: new Image(), loaded: false },
    fallLeaf: { src: 'assets/fall_leaf.png', img: new Image(), loaded: false },
    springLeaf: { src: 'assets/spring_leaf.png', img: new Image(), loaded: false },
    car: { src: 'assets/car.png', img: new Image(), loaded: false },
    gamma: { src: 'assets/gamma.png', img: new Image(), loaded: false },
    racket: { src: 'assets/racket.png', img: new Image(), loaded: false },
    stock: { src: 'assets/stock.png', img: new Image(), loaded: false }
};

const projectIcons = [
    { id: 'car', x: 250, y: 400, revealed: false, label: 'Longhorn Racing' },
    { id: 'gamma', x: 650, y: 300, revealed: false, label: 'Research' },
    { id: 'racket', x: 400, y: 650, revealed: false, label: 'Tennis' },
    { id: 'stock', x: 850, y: 500, revealed: false, label: 'Finance Modeling' }
];

function init() {
    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    });
    window.dispatchEvent(new Event('resize'));

    window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
    window.addEventListener('mousedown', () => {
        // Run to cursor and sit
        dog.state = 'running_to_click';
        projectIcons.forEach(icon => {
            let d = Math.hypot(mouse.x - icon.x, mouse.y - icon.y);
            if (d < 80) {
                icon.revealed = true;
                burstLeaves(icon.x, icon.y, 25); // Major disturbance on click
            }
        });
    });

    Object.keys(assets).forEach(key => {
        assets[key].img.onload = () => { assets[key].loaded = true; };
        assets[key].img.src = assets[key].src;
    });

    for(let i=0; i<200; i++) {
        leaves.push({
            x: Math.random()*window.innerWidth, 
            y: Math.random()*window.innerHeight,
            rot: Math.random()*Math.PI*2,
            type: Math.random() > 0.5 ? 'fallLeaf' : 'springLeaf',
            frame: Math.floor(Math.random()*5)
        });
    }
    requestAnimationFrame(gameLoop);
}

function burstLeaves(x, y, count) {
    for(let i=0; i<count; i++) {
        particles.push({
            x: x, y: y,
            vx: (Math.random()-0.5)*15,
            vy: (Math.random()-0.5)*15 - 5,
            life: 1.0,
            color: Math.random() > 0.5 ? '#e67e22' : '#2ecc71'
        });
    }
}

function gameLoop() {
    ctx.fillStyle = '#3d4a35'; 
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // 1. Physics - "Rubber Band" Leash Logic
    let dx = mouse.x - dog.x;
    let dy = mouse.y - dog.y;
    let dist = Math.hypot(dx, dy);
    let oldX = dog.x;
    let oldY = dog.y;

    if (dist > LEASH_RADIUS || dog.state === 'running_to_click') {
        let speed = (dist > LEASH_RADIUS * 2 || dog.state === 'running_to_click') ? 0.08 : 0.03;
        dog.x += dx * speed;
        dog.y += dy * speed;
        dog.state = speed > 0.05 ? 'running' : 'walking';
        if (dist < 10 && dog.state === 'running_to_click') dog.state = 'idle';
    } else {
        dog.state = 'idle';
    }

    let vx = dog.x - oldX;
    let vy = dog.y - oldY;
    let currentSpeed = Math.hypot(vx, vy);

    // 2. Animation Logic (Row/Col picking)
    if (currentSpeed < 0.2) {
        dog.row = 2; // Sitting facing me
        dog.col = Math.floor(Date.now() / 400) % 2;
    } else {
        // Directional walking/running
        if (Math.abs(vx) > Math.abs(vy)) {
            dog.row = vx > 0 ? 6 : 7; // Rows 7 or 8 (Indices 6/7)
        } else {
            dog.row = vy > 0 ? 4 : 5; // Rows 5 or 6 (Indices 4/5)
        }
        // Change run/walk animation speed
        let animSpeed = dog.state === 'running' ? 80 : 150;
        dog.col = Math.floor(Date.now() / animSpeed) % 4;
    }

    // 3. Draw Icons
    projectIcons.forEach(icon => {
        if (assets[icon.id].loaded) {
            ctx.globalAlpha = icon.revealed ? 1.0 : 0.25;
            ctx.drawImage(assets[icon.id].img, icon.x - 40, icon.y - 40, 80, 80);
            if (icon.revealed) {
                ctx.fillStyle = "white";
                ctx.font = "bold 14px Arial";
                ctx.textAlign = "center";
                ctx.fillText(icon.label, icon.x, icon.y + 60);
            }
        }
    });
    ctx.globalAlpha = 1.0;

    // 4. Draw Leaves (Physical disturbance)
    leaves.forEach(l => {
        let lDist = Math.hypot(l.x - dog.x, l.y - dog.y);
        let force = dog.state === 'running' ? 2.5 : 1.2;
        if (lDist < 40) {
            l.x += vx * force;
            l.y += vy * force;
            l.rot += 0.1 * force;
        }
        if (assets[l.type].loaded) {
            ctx.save();
            ctx.translate(l.x, l.y);
            ctx.rotate(l.rot);
            ctx.drawImage(assets[l.type].img, l.frame * 16, 0, 16, 16, -8, -8, 18, 18);
            ctx.restore();
        }
    });

    // 5. Draw Dog
    if (assets.dog.loaded) {
        ctx.drawImage(assets.dog.img, dog.col * DOG_W, dog.row * DOG_H, DOG_W, DOG_H, dog.x-32, dog.y-40, 64, 80);
    }

    // 6. Particles
    particles.forEach((p, i) => {
        p.x += p.vx; p.y += p.vy; p.vy += 0.3; p.life -= 0.02;
        ctx.fillStyle = p.color;
        ctx.globalAlpha = p.life;
        ctx.fillRect(p.x, p.y, 4, 4);
        if (p.life <= 0) particles.splice(i, 1);
    });

    requestAnimationFrame(gameLoop);
}
init();
</script>
</body>
</html>
